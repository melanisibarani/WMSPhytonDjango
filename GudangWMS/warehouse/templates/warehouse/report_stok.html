{% extends "warehouse/base.html" %}
{% block title %}Report Stok{% endblock %}
{% block content %}

<h3 class="mb-3">Report Stok</h3>

<form class="row g-2 mb-3" method="get">
    <div class="col-auto">
        <div class="filter-date row g-2" {% if request.GET.period != 'date' %}hidden{% endif %}>
            <div class="col-auto">
                <input type="date" name="start" value="{{ request.GET.start }}" class="form-control">
            </div>
            <div class="col-auto">
                <input type="date" name="end" value="{{ request.GET.end }}" class="form-control">
            </div>
        </div>



    </div>
    <div class="col">
        <div id="filter-date" class="row g-2" {% if request.GET.period and request.GET.period != 'date' %}hidden{% endif %}>
            <div class="col-auto"><input type="date" name="start" value="{{ request.GET.start }}" class="form-control"></div>
            <div class="col-auto"><input type="date" name="end" value="{{ request.GET.end }}" class="form-control"></div>
        </div>
        <div id="filter-month" class="row g-2" {% if request.GET.period != 'month' %}hidden{% endif %}>
            <div class="col-auto"><input type="number" name="year" value="{{ request.GET.year }}" placeholder="Year" class="form-control"></div>
            <div class="col-auto"><input type="number" name="month" value="{{ request.GET.month }}" placeholder="Month (1-12)" class="form-control"></div>
        </div>
        <div id="filter-year" class="row g-2" {% if request.GET.period != 'year' %}hidden{% endif %}>
            <div class="col-auto"><input type="number" name="year" value="{{ request.GET.year }}" placeholder="Year" class="form-control"></div>
        </div>
    </div>
    <div class="col-auto"><button class="btn btn-primary">Filter</button></div>
    <div class="col-auto">
        <a class="btn btn-outline-danger" href="{% url 'export_stok_pdf' %}?{{ request.GET.urlencode }}">Export PDF</a>
        <a class="btn btn-outline-success" href="{% url 'export_stok_xlsx' %}?{{ request.GET.urlencode }}">Export Excel</a>
    </div>
</form>

<table class="table table-bordered table-hover">
    <thead class="table-dark">
        <tr>
            <th>Kode</th>
            <th>Nama</th>
            <th>Total In</th>
            <th>Total Out</th>
            <th>Total Qty</th>
        </tr>
    </thead>
    <tbody>
        {% for row in page_obj %}
        <tr>
            <td>{{ row.item__kode_barang }}</td>
            <td>{{ row.item__nama_barang }}</td>
            <td>{{ row.total_in }}</td>
            <td>{{ row.total_out }}</td>
            <td>{{ row.total_qty }}</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="5" class="text-center">Tidak ada data</td>
        </tr>
        {% endfor %}
    </tbody>

</table>
<div class="d-flex justify-content-between align-items-center mt-3">
    <div>
        Showing
        {{ page_obj.start_index }}
        to
        {{ page_obj.end_index }}
        of
        {{ page_obj.paginator.count }} entries
    </div>

    <nav>
        <ul class="pagination mb-0">
            {% if transaksi_list.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?{{ request.GET.urlencode }}&page={{ page_obj.previous_page_number }}">Previous</a>
            </li>
            {% else %}
            <li class="page-item disabled"><span class="page-link">Previous</span></li>
            {% endif %}

            {% for i in transaksi_list.paginator.page_range %}
            {% if transaksi_list.number == i %}
            <li class="page-item active"><span class="page-link">{{ i }}</span></li>
            {% else %}
            <li class="page-item"><a class="page-link" href="?{{ request.GET.urlencode }}&page={{ i }}">{{ i }}</a></li>
            {% endif %}
            {% endfor %}

            {% if transaksi_list.has_next %}
            <li class="page-item">
                <a class="page-link" href="?{{ request.GET.urlencode }}&page={{ page_obj.next_page_number }}">Next</a>
            </li>
            {% else %}
            <li class="page-item disabled"><span class="page-link">Next</span></li>
            {% endif %}
        </ul>
    </nav>
</div>


<script>
    const periodSel = document.querySelector('select[name="period"]');
    periodSel.addEventListener('change', () => {
        document.getElementById('filter-date').hidden = periodSel.value !== 'date';
        document.getElementById('filter-month').hidden = periodSel.value !== 'month';
        document.getElementById('filter-year').hidden = periodSel.value !== 'year';
    });
</script>
{% endblock %}
